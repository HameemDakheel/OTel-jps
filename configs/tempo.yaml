# =============================================================================
# Grafana Tempo Configuration - Monolithic Mode with S3 Backend
# =============================================================================
# Mode: Monolithic (all components in single process)
# Storage: MinIO S3-compatible
# Receivers: OTLP gRPC/HTTP
# =============================================================================

# Server configuration
server:
  http_listen_port: 3200
  grpc_listen_port: 9095
  log_level: info

# Distributor receives traces and forwards to ingester
distributor:
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318

# Ingester configuration
ingester:
  max_block_duration: 5m
  trace_idle_period: 10s
  max_block_bytes: 100000000  # 100MB

# Compactor merges blocks
compactor:
  compaction:
    block_retention: 744h  # 31 days
  ring:
    kvstore:
      store: inmemory

# Query frontend for trace lookups
querier:
  frontend_worker:
    frontend_address: 127.0.0.1:9095

# Storage configuration - S3/MinIO backend
storage:
  trace:
    backend: s3
    s3:
      endpoint: minio:9000
      bucket: tempo
      access_key_id: ${MINIO_ROOT_USER}
      secret_access_key: ${MINIO_ROOT_PASSWORD}
      insecure: true
      s3forcepathstyle: true
    wal:
      path: /var/tempo/wal
    local:
      path: /var/tempo/blocks
    pool:
      max_workers: 100
      queue_depth: 10000

# Memberlist for ring (single node)
memberlist:
  abort_if_cluster_join_fails: false
  join_members: []

# Metrics generator - derive metrics from traces
metrics_generator:
  registry:
    external_labels:
      source: tempo
  storage:
    path: /var/tempo/generator/wal
    remote_write:
      - url: http://mimir:8080/api/v1/push
        send_exemplars: true
  traces_storage:
    path: /var/tempo/generator/traces

# Overrides for limits
overrides:
  defaults:
    metrics_generator:
      processors:
        - service-graphs
        - span-metrics

# Analytics
usage_report:
  reporting_enabled: false
